"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[596],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(a),h=r,m=u["".concat(l,".").concat(h)]||u[h]||c[h]||i;return a?n.createElement(m,o(o({ref:t},d),{},{components:a})):n.createElement(m,o({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},5144:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={title:"DataSQRL Tutorial"},o="DataSQRL Tutorial",s={unversionedId:"getting-started/intro/overview",id:"getting-started/intro/overview",title:"DataSQRL Tutorial",description:"The DataSQRL tutorial introduces you to everything you need to know about DataSQRL while building a Customer 360\xb0 application and recommendation engine. The tutorial is broken into individual chapters that focus on a particular aspect of DataSQRL.",source:"@site/docs/getting-started/intro/overview.md",sourceDirName:"getting-started/intro",slug:"/getting-started/intro/overview",permalink:"/docs/getting-started/intro/overview",draft:!1,editUrl:"https://github.com/DataSQRL/datasqrl.github.io/edit/main/docs/getting-started/intro/overview.md",tags:[],version:"current",frontMatter:{title:"DataSQRL Tutorial"},sidebar:"docs",previous:{title:"Quickstart Tutorial",permalink:"/docs/getting-started/quickstart"},next:{title:"Implement SQRL Script",permalink:"/docs/getting-started/intro/sqrl"}},l={},p=[{value:"Setup",id:"setup",level:2},{value:"Create SQL Script",id:"sqrl",level:2},{value:"Run Script",id:"run",level:2},{value:"Query Data API",id:"query",level:2},{value:"Next Steps",id:"next",level:2}],d={toc:p},u="wrapper";function c(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"datasqrl-tutorial"},"DataSQRL Tutorial"),(0,r.kt)("p",null,"The DataSQRL tutorial introduces you to everything you need to know about DataSQRL while building a Customer 360\xb0 application and recommendation engine. The tutorial is broken into individual chapters that focus on a particular aspect of DataSQRL."),(0,r.kt)("img",{src:"/img/getting-started/squirrel_seedshop.png",alt:"Nut Shop Tutorial >|",width:"40%"}),(0,r.kt)("p",null,"Because we have the humor of middle schoolers, we are going to build customer experience features for our ficticious online DataSQRL seed shop. Seeds and squirrels - how funny are we?"),(0,r.kt)("p",null,"Specifically, we will build a data product to integrate customer data from various sources, process it, and provide features like spending analysis, recommendations, and personalized offers through an API to enhance our seed shop customer experience."),(0,r.kt)("p",null,"That sounds like a lot, but DataSQRL makes it easy. Plus, we'll break it up into chapters to introduce core DataSQRL concepts one at a time."),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("p",null,"Before we get started, let's get some setup tasks out of the way:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Make sure you have ",(0,r.kt)("a",{parentName:"li",href:"https://docs.docker.com/get-docker/"},"Docker installed")," and running on your machine. Run ",(0,r.kt)("inlineCode",{parentName:"li"},"docker compose version")," in the terminal and check that the version starts with ",(0,r.kt)("inlineCode",{parentName:"li"},"v2"),"."),(0,r.kt)("li",{parentName:"ol"},"Create a directory for our project files. Type the following into your terminal or command line:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"> mkdir seedshop; cd seedshop\n")),(0,r.kt)("h2",{id:"sqrl"},"Create SQL Script"),(0,r.kt)("p",null,"Create a new file called ",(0,r.kt)("inlineCode",{parentName:"p"},"seedshop.sqrl")," and paste the following content into the file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"IMPORT datasqrl.seedshop.Orders;  \nIMPORT time.endOfWeek;            \n\nOrders.items.total := quantity * unit_price - discount?0.0;\nOrders.totals := SELECT sum(total) as price,\n                  sum(discount?0.0) as saving FROM @.items;\n\nUsers := SELECT DISTINCT customerid AS id FROM Orders;\n\nUsers.purchases := JOIN Orders ON Orders.customerid = @.id;\n\nUsers.spending := SELECT endOfWeek(p.time) AS week,\n         sum(t.price) AS spend, sum(t.saving) AS saved\n      FROM @.purchases p JOIN p.totals t\n      GROUP BY week ORDER BY week DESC;\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"This tutorial assumes some basic familiarity with SQL. If you are unfamiliar with SQL, we recommend you read our ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/sqrl/sql-primer"},"SQL Primer")," first.")),(0,r.kt)("p",null,"We express the data transformations and processing of our service in SQL by incrementally defining tables and columns. DataSQRL's flavor of SQL is called ",(0,r.kt)("strong",{parentName:"p"},"SQRL"),' because DataSQRL supports relationships and reactions to changes in data (hence the extra "',(0,r.kt)("strong",{parentName:"p"},"R"),'").'),(0,r.kt)("p",null,"Let's break down this SQRL script line-by-line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"IMPORT datasqrl.seedshop.Orders;  \n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"import")," statement imports the ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," table from the package ",(0,r.kt)("a",{parentName:"p",href:"https://dev.datasqrl.com/package/datasqrl.seedshop"},"datasqrl.seedshop"),". SQRL treats data like software dependencies which makes it easier to depend on external data sources and allows the compiler to manage all the data plumbing for you. This data source is imported from the ",(0,r.kt)("a",{parentName:"p",href:"https://dev.datasqrl.com"},"DataSQRL repository"),". We'll discuss how to create your own data sources in a ",(0,r.kt)("a",{parentName:"p",href:"../data-sources"},"future chapter"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," table has a nested ",(0,r.kt)("inlineCode",{parentName:"p"},"items")," table to represent the nested item records for each order. SQRL supports nested tables to represent hierarchical data natively via the ",(0,r.kt)("inlineCode",{parentName:"p"},".")," dot notation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"Orders.items.total := quantity * unit_price - discount?0.0;\n")),(0,r.kt)("p",null,"We are adding the ",(0,r.kt)("inlineCode",{parentName:"p"},"total")," column to the nested ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders.items")," table to compute the total price for each item in an order."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"Orders.totals := SELECT sum(total) as price,\n                  sum(discount?0.0) as saving FROM @.items;\n")),(0,r.kt)("p",null,"We are defining ",(0,r.kt)("inlineCode",{parentName:"p"},"totals")," as a nested table underneath ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," to compute the total price and savings for each order by aggregating over all items in the order. Note the use of ",(0,r.kt)("inlineCode",{parentName:"p"},"@")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"FROM")," clause. ",(0,r.kt)("inlineCode",{parentName:"p"},"@")," refers to each row in the parent ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," table and is used when defining localized queries. A localized query allows us to refer to the items for ",(0,r.kt)("em",{parentName:"p"},"each")," order instead of aggregating across items for ",(0,r.kt)("em",{parentName:"p"},"all")," orders."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Orders.items")," is a nested table that is accessible via the relationship column ",(0,r.kt)("inlineCode",{parentName:"p"},"items")," from each row in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," table to retrieve the items of that order."),(0,r.kt)("p",null,"SQRL supports relationships as first-class citizens of the language, so we can express relationships in the data explicitly."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"Users.purchases := JOIN Orders ON Orders.customerid = @.id;\n")),(0,r.kt)("p",null,"This statement defines the relationship column ",(0,r.kt)("inlineCode",{parentName:"p"},"purchases")," on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Users")," table which links a user to the orders they placed. The ",(0,r.kt)("inlineCode",{parentName:"p"},"@")," refers to the parent ",(0,r.kt)("inlineCode",{parentName:"p"},"Users")," table on the left-hand side."),(0,r.kt)("p",null,"And, for the grand finale, we have the spending analysis that aggregates a user's total spending by week:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"Users.spending := SELECT endOfWeek(p.time) AS week,\n         sum(t.price) AS spend, sum(t.saving) AS saved\n      FROM @.purchases p JOIN p.totals t\n      GROUP BY week ORDER BY week DESC;\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"spending")," is defined as a nested table underneath ",(0,r.kt)("inlineCode",{parentName:"p"},"Users")," and uses the imported time-window function ",(0,r.kt)("inlineCode",{parentName:"p"},"endOfWeek")," to aggregate the totals for all orders that fall within a given week."),(0,r.kt)("p",null,"Note, that we can use previously defined relationships in ",(0,r.kt)("inlineCode",{parentName:"p"},"FROM")," clauses and ",(0,r.kt)("inlineCode",{parentName:"p"},"JOIN")," to simplify the query."),(0,r.kt)("p",null,"We are going to cover SQRL in more detail in the ",(0,r.kt)("a",{parentName:"p",href:"../sqrl"},"next chapter"),", but the bottom line is this: SQRL is just SQL with some syntactic sugar that makes it easier to represent nested data and relationships, so you can structure your data how you want to expose it."),(0,r.kt)("h2",{id:"run"},"Run Script"),(0,r.kt)("p",null,"Invoke the DataSQRL compiler to build an integrated pipeline from the data transformations and aggregations defined in the script:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run --rm -v $PWD:/build datasqrl/cmd compile seedshop.sqrl\n")),(0,r.kt)("p",null,"Launch the pipeline with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(cd build/deploy; docker compose up)\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you run into an 'java.lang.OutOfMemoryError: Could not allocate enough memory segments for NetworkBufferPool' error, increase the memory resources in the docker settings to at least 6gb.")),(0,r.kt)("h2",{id:"query"},"Query Data API"),(0,r.kt)("p",null,"The running pipeline compiled by DataSQRL exposes a GraphQL data API which you can access by opening ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:8888//graphiql/"},(0,r.kt)("inlineCode",{parentName:"a"},"http://localhost:8888//graphiql/"))," in your browser. Write GraphQL queries in the left-hand panel. For example, copy the following query:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"{\nUsers (id: 10) {\n    purchases {\n        id\n        totals {\n            price\n            saving\n        }\n    }    \n    spending {\n        week\n        spend\n        saved\n    }\n}}\n")),(0,r.kt)("p",null,'When you hit the "run" button you get the purchase history and spending analysis for the customer with ',(0,r.kt)("inlineCode",{parentName:"p"},"id=10")," in the right-hand panel."),(0,r.kt)("p",null,"Feel free to adjust the query and play around with the API. Note, how DataSQRL maps every table to an API endpoint and exposes the data with the structure and relationships we defined in the script."),(0,r.kt)("p",null,"In this example, DataSQRL is generating the API for us which is convenient when you are starting out. In a ",(0,r.kt)("a",{parentName:"p",href:"../api"},"future chapter")," we are going to customize the API to our needs."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"To stop the pipeline, interrupt it with ",(0,r.kt)("inlineCode",{parentName:"p"},"CTRL-C")," and shut it down with:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"(cd build/deploy; docker compose down -v)\n")),(0,r.kt)("p",{parentName:"admonition"},"It's important to remove the containers and volumes with this command before launching another pipeline to get updated containers. ")),(0,r.kt)("h2",{id:"next"},"Next Steps"),(0,r.kt)("p",null,"And that's how you build data pipelines with DataSQRL: write a SQRL script, run the DataSQRL command to compile and run a pipeline, and inspect the API to verify that it meets your expectations."),(0,r.kt)("p",null,"In the following chapters, we will cover each of these steps in more detail. First up: ",(0,r.kt)("a",{parentName:"p",href:"../sqrl"},"writing the SQRL script"),"."))}c.isMDXComponent=!0}}]);