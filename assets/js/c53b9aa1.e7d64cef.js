"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9616],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),h=p(n),u=r,m=h["".concat(l,".").concat(u)]||h[u]||c[u]||i;return n?a.createElement(m,s(s({ref:t},d),{},{components:n})):a.createElement(m,s({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[h]="string"==typeof e?e:r,s[1]=o;for(var p=2;p<i;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6877:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={title:"Relationship"},s="Relationships in SQRL",o={unversionedId:"reference/sqrl/relationship",id:"reference/sqrl/relationship",title:"Relationship",description:"SQRL supports relationship columns which relate a row in one table to rows in another table.",source:"@site/docs/reference/sqrl/relationship.md",sourceDirName:"reference/sqrl",slug:"/reference/sqrl/relationship",permalink:"/docs/reference/sqrl/relationship",draft:!1,editUrl:"https://github.com/DataSQRL/datasqrl.github.io/edit/main/docs/docs/reference/sqrl/relationship.md",tags:[],version:"current",frontMatter:{title:"Relationship"},sidebar:"docs",previous:{title:"Table",permalink:"/docs/reference/sqrl/table"},next:{title:"Stream Table",permalink:"/docs/reference/sqrl/stream"}},l={},p=[{value:"JOINs",id:"joins",level:2},{value:"Relationship Expressions",id:"expressions",level:2},{value:"API Access",id:"api-access",level:2},{value:"Multiplicity",id:"multiplicity",level:2}],d={toc:p},h="wrapper";function c(e){let{components:t,...n}=e;return(0,r.kt)(h,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"relationships-in-sqrl"},"Relationships in SQRL"),(0,r.kt)("p",null,"SQRL supports relationship columns which relate a row in one table to rows in another table."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"Users.purchases := JOIN Orders ON Orders.customerid = @.id;\n")),(0,r.kt)("p",null,"This statement defines a relationship column ",(0,r.kt)("inlineCode",{parentName:"p"},"purchases")," on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Users")," table that relates each user record to rows in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," table where the ",(0,r.kt)("inlineCode",{parentName:"p"},"customerid")," is equal to the user ",(0,r.kt)("inlineCode",{parentName:"p"},"id"),". In other words, ",(0,r.kt)("inlineCode",{parentName:"p"},"purchases")," relates users to their orders."),(0,r.kt)("p",null,"A relationship is defined via a ",(0,r.kt)("inlineCode",{parentName:"p"},"JOIN")," expression in standard SQL syntax. Relationships are defined as ",(0,r.kt)("a",{parentName:"p",href:"table#localized"},"localized queries")," which means the ",(0,r.kt)("inlineCode",{parentName:"p"},"JOIN")," expression on the right-hand side of the statement is interpreted for each row of the table on which the relationship is defined and the at-sign ",(0,r.kt)("inlineCode",{parentName:"p"},"@")," is used to refer to each row."),(0,r.kt)("p",null,"Relationship columns are a convenient way to make relationships in the data explicit, simplify joins, and allow consumers of the data API to navigate through the data."),(0,r.kt)("h2",{id:"joins"},"JOINs"),(0,r.kt)("p",null,"Relationships can be used in ",(0,r.kt)("inlineCode",{parentName:"p"},"FROM")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"JOIN")," clauses of queries which makes complex join-queries easier to read. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"Users.spending := SELECT endOfWeek(p.time) AS week,\n         sum(t.price) AS spend, sum(t.saving) AS saved\n      FROM @.purchases p JOIN p.totals t\n      GROUP BY week ORDER BY week DESC;\n")),(0,r.kt)("p",null,"This statement defines a nested table ",(0,r.kt)("inlineCode",{parentName:"p"},"spending")," underneath ",(0,r.kt)("inlineCode",{parentName:"p"},"Users")," which aggregates over the nested order ",(0,r.kt)("inlineCode",{parentName:"p"},"totals")," for all purchases of each user. Relationships used in ",(0,r.kt)("inlineCode",{parentName:"p"},"FROM")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"JOIN")," are expanded to their original definition. That means, ",(0,r.kt)("inlineCode",{parentName:"p"},"FROM @.purchases")," gets expanded to ",(0,r.kt)("inlineCode",{parentName:"p"},"FROM @ JOIN Orders p ON p.customerid = @.id"),"."),(0,r.kt)("p",null,"Relationships are particularly useful in the context of nested tables because they make it easy to navigate between parent and child. In the ",(0,r.kt)("a",{parentName:"p",href:"../../getting-started/quickstart"},"Quickstart tutorial")," we define the nested ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders.totals")," table as an aggregation over all items."),(0,r.kt)("p",null,"When defining a nested table, each child row has a relationship column ",(0,r.kt)("inlineCode",{parentName:"p"},"parent")," to relates the child row to its parent row. Likewise, the parent table has a relationship column with the name of the nested table that provides access to all child rows of the parent."),(0,r.kt)("p",null,"Hence, we are able to use ",(0,r.kt)("inlineCode",{parentName:"p"},"JOIN p.totals")," to join the totals for each order by following the ",(0,r.kt)("inlineCode",{parentName:"p"},"totals")," relationship on the order row."),(0,r.kt)("h2",{id:"expressions"},"Relationship Expressions"),(0,r.kt)("p",null,"Relationships can be used inside expressions in a query."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"UsersWithSpending := SELECT id, email, order_stats.spend AS spend \n                     FROM Users;\n")),(0,r.kt)("p",null,"This statement defines a new table ",(0,r.kt)("inlineCode",{parentName:"p"},"UsersWithSpending")," that combines user information with their total spending from the nested ",(0,r.kt)("inlineCode",{parentName:"p"},"order_stats")," table we defined in the ",(0,r.kt)("a",{parentName:"p",href:"../../getting-started/intro/advanced"},"intro tutorial"),"."),(0,r.kt)("p",null,"Using relationships in expressions simplifies the query by eliminating a join. "),(0,r.kt)("p",null,"Moreover, a relationship expression can be used to pull in optional data. ",(0,r.kt)("inlineCode",{parentName:"p"},"UsersWithSpending")," contains one row per user and ",(0,r.kt)("inlineCode",{parentName:"p"},"order_stats.spend")," evaluates to ",(0,r.kt)("inlineCode",{parentName:"p"},"null")," if a user does not have any orders."),(0,r.kt)("p",null,"Contrast this with the following table definition that references the spending through an explicit join on the relationship:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"UsersWithSpending := SELECT u.id, u.email, s.spend \n                     FROM Users u JOIN u.order_stats s;\n")),(0,r.kt)("p",null,"This table contains only rows for users who placed an order since the ",(0,r.kt)("inlineCode",{parentName:"p"},"JOIN")," on ",(0,r.kt)("inlineCode",{parentName:"p"},"u.order_stats")," makes it required."),(0,r.kt)("p",null,"For SQL nerds: Relationships expressions are expanded to left-joins."),(0,r.kt)("p",null,"Relationship expression can also be used in WHERE clauses to filter out data."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"HighSpendingUsers := SELECT id, email FROM Users \n                     WHERE order_stats.spend > 1000;\n")),(0,r.kt)("p",null,"This table contains user information for those users who have spent more than a thousand dollars in total."),(0,r.kt)("h2",{id:"api-access"},"API Access"),(0,r.kt)("p",null,"The relationships defined in a SQRL script can be exposed in the resulting data API to give consumers of the API the ability to navigate through the data and retrieve related records. Relationships make it possible to represent complex data efficiently through the API."),(0,r.kt)("p",null,"To learn more about how to expose and navigate relationships in the data API, refer to the ",(0,r.kt)("a",{parentName:"p",href:"../api/overview"},"API documentation"),"."),(0,r.kt)("h2",{id:"multiplicity"},"Multiplicity"),(0,r.kt)("p",null,"Relationships are defined as SQL ",(0,r.kt)("inlineCode",{parentName:"p"},"JOIN")," clauses with the at-sign ",(0,r.kt)("inlineCode",{parentName:"p"},"@")," used to refer to the table on which the relationship is defined."),(0,r.kt)("p",null,"In addition, we can add an ",(0,r.kt)("inlineCode",{parentName:"p"},"ORDER BY")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"LIMIT")," clause to the relationship."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"Users.recent_purchases := JOIN Orders ON Orders.customerid = @.id ORDER BY Orders.time LIMIT 10;\n")),(0,r.kt)("p",null,"This statement defines the relationship column ",(0,r.kt)("inlineCode",{parentName:"p"},"recent_purchases")," similar to the ",(0,r.kt)("inlineCode",{parentName:"p"},"purchases")," relationship above but orders the related ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," row by ",(0,r.kt)("inlineCode",{parentName:"p"},"time")," and restricts the number of related rows to 10."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ORDER BY")," clause is used to make the order in which the related rows are returned in the API explicit."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"LIMIT")," clause is used to restrict the multiplicity of the relationship."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"Users.last_purchase := JOIN Orders ON Orders.customerid = @.id LIMIT 1;\n")),(0,r.kt)("p",null,"This statement defines a relationship with ",(0,r.kt)("inlineCode",{parentName:"p"},"0..1")," multiplicity."))}c.isMDXComponent=!0}}]);