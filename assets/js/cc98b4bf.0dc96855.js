"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5275],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},h="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=p(n),u=r,c=h["".concat(s,".").concat(u)]||h[u]||m[u]||i;return n?a.createElement(c,o(o({ref:t},d),{},{components:n})):a.createElement(c,o({ref:t},d))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[h]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2850:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={title:"Design"},o="Design GraphQL APIs",l={unversionedId:"reference/api/graphql/design",id:"reference/api/graphql/design",title:"Design",description:"The easiest way to design your custom GraphQL data API with DataSQRL is to start with the GraphQL schema that is generated by the compiler.",source:"@site/docs/reference/api/graphql/design.md",sourceDirName:"reference/api/graphql",slug:"/reference/api/graphql/design",permalink:"/docs/reference/api/graphql/design",draft:!1,editUrl:"https://github.com/DataSQRL/datasqrl.github.io/edit/main/docs/docs/reference/api/graphql/design.md",tags:[],version:"current",frontMatter:{title:"Design"},sidebar:"docs",previous:{title:"Data API",permalink:"/docs/reference/api/overview"},next:{title:"Query",permalink:"/docs/reference/api/graphql/query"}},s={},p=[{value:"Script to GraphQL Schema Mapping",id:"script-to-graphql-schema-mapping",level:2},{value:"GraphQL Schema Customization",id:"graphql-schema-customization",level:2},{value:"Adding Pagination",id:"adding-pagination",level:3},{value:"Full Example GraphQL Schema",id:"full-example-graphql-schema",level:3},{value:"Additional Reading",id:"additional-reading",level:2}],d={toc:p},h="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(h,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"design-graphql-apis"},"Design GraphQL APIs"),(0,r.kt)("p",null,"The easiest way to design your custom GraphQL data API with DataSQRL is to start with the GraphQL schema that is generated by the compiler."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run --rm -v $PWD:/build datasqrl/cmd compile myscript.sqrl -a graphql\n")),(0,r.kt)("p",null,"When you add the ",(0,r.kt)("inlineCode",{parentName:"p"},"-a graphql")," option, the compiler writes a ",(0,r.kt)("inlineCode",{parentName:"p"},"schema.graphqls")," GraphQL schema file to the local directory where the compiler was invoked."),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Change the name of the GraphQL schema file before you customize it. That way you avoid accidentally overwriting your changes if you run the command with the ",(0,r.kt)("inlineCode",{parentName:"p"},"-a")," option again.")),(0,r.kt)("h2",{id:"script-to-graphql-schema-mapping"},"Script to GraphQL Schema Mapping"),(0,r.kt)("p",null,"DataSQRL maps the tables, fields, and relationships defined in the SQRL script to a GraphQL schema which exposes the data through a GraphQL API."),(0,r.kt)("p",null,"Tables are mapped to types in the GraphQL schema and table columns map to fields of that type. The field data type is the same as the column data type from the table. If the type isn't available in GraphQL, it is serialized into a generic type like ",(0,r.kt)("inlineCode",{parentName:"p"},"string"),"."),(0,r.kt)("p",null,"Relationship columns of a table map to fields of the type associated with the table. The type of that field is the type associated with the table that the relationship links to."),(0,r.kt)("p",null,"The mapping between tables and types and (relationship) columns and fields is established by case-insensitive name. That means, to expose the table ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," in the API we have to create a type ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"orders")," in the GraphQL schema."),(0,r.kt)("p",null,"For example, the ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," table we imported in the ",(0,r.kt)("a",{parentName:"p",href:"../../../../getting-started/quickstart"},"Quickstart tutorial")," maps onto the following type in GraphQL"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"type Orders {\n  id: Int!\n  customerid: Int!\n  time: String!\n  items(productid: Int, quantity: Int, unit_price: Float, discount: Float, total: Float): [items!]\n  totals: totals\n}\n")),(0,r.kt)("p",null,"The type has one field for each column in the table with the same name as the column. The data type of the field is determined by the data type of the column. The exclamation mark ",(0,r.kt)("inlineCode",{parentName:"p"},"!")," indicates that a field is non-null, which is also inferred from the data type of the column."),(0,r.kt)("p",null,"The type has a relationship field ",(0,r.kt)("inlineCode",{parentName:"p"},"items")," that links to the nested ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders.items")," table which is mapped to the type ",(0,r.kt)("inlineCode",{parentName:"p"},"items")," in the GraphQL schema. For nested tables, the type name is equal to the name of the table and not the full table path."),(0,r.kt)("p",null,"The field ",(0,r.kt)("inlineCode",{parentName:"p"},"totals")," is a relationship field to the nested ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders.totals")," table that aggregates the total price and savings for each order. The compiler infers whether a relationship has a to-one or to-many multiplicity. The ",(0,r.kt)("inlineCode",{parentName:"p"},"totals")," relationship returns a single object of type ",(0,r.kt)("inlineCode",{parentName:"p"},"totals")," whereas the ",(0,r.kt)("inlineCode",{parentName:"p"},"items")," relationship returns an array of ",(0,r.kt)("inlineCode",{parentName:"p"},"[items!]"),". For to-one relationships, no optional argument filters are generated. "),(0,r.kt)("p",null,"The relationship field accepts optional arguments for each field of the related type to filter on. That means, if we traverse the ",(0,r.kt)("inlineCode",{parentName:"p"},"items")," relationship and provide an argument for product id ",(0,r.kt)("inlineCode",{parentName:"p"},"productid: 10"),", then the relationship field only returns those items where the product id is equal to ",(0,r.kt)("inlineCode",{parentName:"p"},"10"),"."),(0,r.kt)("p",null,"The nested table ",(0,r.kt)("inlineCode",{parentName:"p"},"Users.spending")," is mapped to the following type in GraphQL"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"type spending {\n  week: String!\n  spend: Float!\n  saved: Float!\n  parent: Users!\n}\n")),(0,r.kt)("p",null,"The type has a field for each column in the table. In addition, it has the relationship field ",(0,r.kt)("inlineCode",{parentName:"p"},"parent")," that relates a nested table record to its parent record from the ",(0,r.kt)("inlineCode",{parentName:"p"},"Users")," table."),(0,r.kt)("p",null,"Non-nested tables in the script  map onto query entry-points of the same name as the table which can be used to query the table. In our ",(0,r.kt)("a",{parentName:"p",href:"../../../../getting-started/quickstart"},"Quickstart example"),", we have the root (i.e. non-nested) tables ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Users")," which are exposed through the following query endpoints:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphl"},"type Query {\n  Orders(id: Int, customerid: Int, time: String): [orders!]\n  Users(id: Int): [Users!]\n}\n")),(0,r.kt)("p",null,"Like relationship fields, query fields have optional arguments for each field of the returned type to filter on. For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"Users(id: 5)")," returns the user with id equal to ",(0,r.kt)("inlineCode",{parentName:"p"},"5"),"."),(0,r.kt)("h2",{id:"graphql-schema-customization"},"GraphQL Schema Customization"),(0,r.kt)("p",null,"The compiler generates ",(0,r.kt)("em",{parentName:"p"},"complete")," GraphQL schemas, which means that the schema contains all tables, fields, and relationships defined in the SQRL script as well as field filters for all fields. In most cases, we don't want to expose all of those in the data API."),(0,r.kt)("p",null,"You can create your own custom GraphQL schema by trimming the generated schema and only expose those tables, fields, relationships, and filters that are required by your data API."),(0,r.kt)("p",null,"In our ",(0,r.kt)("a",{parentName:"p",href:"../../../../getting-started/quickstart"},"Quickstart example")," we don't need any filters for the items in each order, so we remove all the arguments from that field."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"type Orders {\n  id: Int!\n  customerid: Int!\n  time: String!\n  items: [items!]\n  totals: totals\n}\n")),(0,r.kt)("p",null,"We also don't need to navigate from the nested ",(0,r.kt)("inlineCode",{parentName:"p"},"Users.spending")," back to ",(0,r.kt)("inlineCode",{parentName:"p"},"Users")," so we remove the ",(0,r.kt)("inlineCode",{parentName:"p"},"parent")," relationship field."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"type spending {\n  week: String!\n  spend: Float!\n  saved: Float!\n}\n")),(0,r.kt)("p",null,"For the query endpoints, we only want to filter ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders")," by ",(0,r.kt)("inlineCode",{parentName:"p"},"time")," and return a single user by id, with the ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," being a required argument:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"type Query {\n  Orders(time: String): [Orders!]\n  Users(id: Int!): Users\n}\n")),(0,r.kt)("h3",{id:"adding-pagination"},"Adding Pagination"),(0,r.kt)("p",null,"Pagination allows the user of an API to page through the results when there are too many results to return them all at once.\nFor our example, we might have thousands of orders and wouldn't want to return all of them when the user accesses the ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders()")," query end point of our API."),(0,r.kt)("p",null,"To limit the number of results the API returns and allow the user to page through the results to retrieve them incrementally, we add ",(0,r.kt)("inlineCode",{parentName:"p"},"limit")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"offset")," arguments to query endpoints and relationship fields in GraphQL schema."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"type Query {\n  Orders(time: String, limit: Int!, offset: Int = 0): [Orders!]\n  Users(id: Int!): Users\n}\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Orders()")," query endpoint requires a limit and an optional offset which defaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"0"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"type Users {\n  id: Int!\n  purchases(limit: Int!, offset: Int): [Orders!]\n  spending(week: String, limit: Int = 20): [spending!]\n}\n")),(0,r.kt)("p",null,"In the type definition for ",(0,r.kt)("inlineCode",{parentName:"p"},"Users")," above, we use ",(0,r.kt)("inlineCode",{parentName:"p"},"limit")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"offset")," arguments to allow users of the API to page through the purchase history of a user and return a limited amount of spending analysis."),(0,r.kt)("h3",{id:"full-example-graphql-schema"},"Full Example GraphQL Schema"),(0,r.kt)("p",null,"The following is the final customized GraphQL schema for our ",(0,r.kt)("a",{parentName:"p",href:"../../../../getting-started/quickstart"},"Quickstart example"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphqls"},"type Query {\n  Orders(time: String, limit: Int!, offset: Int = 0): [Orders!]\n  Users(id: Int!): Users\n}\n\ntype Users {\n  id: Int!\n  purchases(limit: Int!, offset: Int): [Orders!]\n  spending(week: String, limit: Int = 20): [spending!]\n}\n\ntype spending {\n  week: String!\n  spend: Float!\n  saved: Float!\n}\n\ntype Orders {\n  id: Int!\n  customerid: Int!\n  time: String!\n  items: [items!]\n  totals: totals\n}\n\ntype items {\n  productid: Int!\n  quantity: Int!\n  unit_price: Float!\n  discount: Float\n  total: Float!\n}\n\ntype totals {\n  price: Float!\n  saving: Float!\n}\n")),(0,r.kt)("h2",{id:"additional-reading"},"Additional Reading"),(0,r.kt)("p",null,"Refer to the ",(0,r.kt)("a",{parentName:"p",href:"../../../../getting-started/intro/api"},"API chapter")," of the intro tutorial for a step-by-step guide to customizing GraphQL APIs."))}m.isMDXComponent=!0}}]);