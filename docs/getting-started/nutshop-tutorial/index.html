<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DataSQRL RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DataSQRL Atom Feed"><title data-react-helmet="true">Intro Tutorial | DataSQRL</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://dataengai.github.io/docs/getting-started/nutshop-tutorial"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Intro Tutorial | DataSQRL"><meta data-react-helmet="true" name="description" content="Because we have the humor of a middle schooler on Adderall, this introductory tutorial"><meta data-react-helmet="true" property="og:description" content="Because we have the humor of a middle schooler on Adderall, this introductory tutorial"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dataengai.github.io/docs/getting-started/nutshop-tutorial"><link data-react-helmet="true" rel="alternate" href="https://dataengai.github.io/docs/getting-started/nutshop-tutorial" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dataengai.github.io/docs/getting-started/nutshop-tutorial" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.deb948f4.css">
<link rel="preload" href="/assets/js/runtime~main.9851348b.js" as="script">
<link rel="preload" href="/assets/js/main.3edf6f1d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/head_squirrel.svg" alt="DataSQRL Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/head_squirrel.svg" alt="DataSQRL Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">DataSQRL</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/getting-started/overview">Learn</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/blog">News</a><a class="navbar__item navbar__link" href="/support">Support</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tbd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleChecked_cnQY toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" checked="" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/docs/getting-started/overview">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/install">Download &amp; Install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/nutshop-tutorial">Intro Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/getting-started/intro/overview">DataSQRL Training</a><button aria-label="Toggle the collapsible sidebar category &#x27;DataSQRL Training&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/why-datasqrl">Why DataSQRL?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/getting-started/comparison/overview">DataSQRL Comparison</a><button aria-label="Toggle the collapsible sidebar category &#x27;DataSQRL Comparison&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/guides/overview">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/reference/overview">Reference Documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference Documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/dev/overview">Developer Documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Customer 360 Tutorial</h1><p>Because we have the humor of a middle schooler on Adderall, this introductory tutorial
will implement data-driven features for our online DataSQRL nut shop. Nuts and squirrels -
how funny are we?</p><p>The DataSQRL nut shop is a pretty basic online shop that processes and keeps track of orders
placed by customers. We want to add Customer 360 functionality to the shop, which means giving
customers insights into their past orders and recommending products to purchase. In short, we
want to use the data we have about our customers to sell them nuts with a personalized touch.</p><p><img alt="DataSQRL Nut Shop" src="/assets/images/nutshop-f64d041f48e627c5dfcb7feef6e1afbd.jpg" width="800" height="368"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="setup">Install<a class="hash-link" href="#setup" title="Direct link to heading">â€‹</a></h2><p>Before the fun begins, we need to install DataSQRL so you can run the service we are building.
Follow the <a href="/docs/getting-started/install">Download &amp; Install</a>
instruction. It&#x27;ll be quick. We will wait right here.</p><p>Let&#x27;s fire up DataSQRL by executing the following command into your terminal or shell:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">datasqrl run dev </span><span class="token operator">&amp;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This runs the DataSQRL server in development mode as a background process, so we can build a new
data service. When you are done with development, you can stop the process by executing
<code>datasqrl stop</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="adding-data">Step 1: Adding Data<a class="hash-link" href="#adding-data" title="Direct link to heading">â€‹</a></h2><p>First, we are going to add some data from our online shop for us to play with. Navigate to
a directory on your computer where you can place files for this tutorial. <a href="/">Download this zip
archive</a> and unzip it in the folder. You should see the folder <code>nutshop-data</code> which
contains the order and product data for our shop.</p><p>Let&#x27;s feed that data to DataSQRL with the following command:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">datasqrl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> folder nutshop-data</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This command instructs DataSQRL to connect the data in the <code>nutshop-data</code> folder as a
dataset and gives you the following response:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connecting </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;nutshop-data&quot;</span><span class="token plain"> to DataSQRL server </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;localhost:7050&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Adding dataset </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;nutshop-data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Adding table </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;nutshop-data.Products&quot;</span><span class="token plain"> with files </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">products.csv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Adding table </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;nutshop-data.Orders&quot;</span><span class="token plain"> with files </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">orders_*.json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can now access the data and build a data service with it. Create a file called
<code>customer360.sqrl</code> and open it in your favorite editor. This is the SQRL script where
we define the transformations and logic for our Customer 360 data service. SQRL is an
extension of SQL that adds a few concepts and some syntactic sugar to make it easier to
develop with SQL and build data services. SQRL is like adding bacon to a sandwich: it makes
SQL better in ways that seem obvious in hindsight.</p><p>Add the following two import statements to your <code>customer360.sqrl</code> script:</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">IMPORT nutshop-data.Products;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">IMPORT nutshop-data.Orders;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This imports the <code>Products</code> and <code>Orders</code> tables from the <code>nutshop-data</code> dataset to our script.
In DataSQLR, all data is structured as tables and tables are grouped into datasets.</p><p>In your terminal, execute the following command to run our little SQRL script:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">datasqrl dev customer360.sqrl</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This command continuously monitors your SQRL script and submits any changes to the running
DataSQRL server for execution. The server executes the script and generates a data service
from the result which is exposed as a GraphQL API.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="api">Querying the API<a class="hash-link" href="#api" title="Direct link to heading">â€‹</a></h3><p>The command also opens a page in your browser where you can inspect the resulting API with
GraphiQL, which is a lightweight IDE for your API. Try it out by pasting the following
GraphQL query into the left hand side and hitting the run button:</p><div class="codeBlockContainer_I0IT language-graphql theme-code-block"><div class="codeBlockContent_wNvx graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    products</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token attr-name" style="color:rgb(241, 250, 140)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token attr-name" style="color:rgb(241, 250, 140)">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token attr-name" style="color:rgb(241, 250, 140)">eq</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        items </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sizing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            weight_in_grams</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You should see the requested information for the product with id equal to &quot;1&quot;. You can modify
the filter condition to query for products by their fields.</p><p>Voila, we got a functioning data service with <code>products</code> and <code>orders</code> API entry points
for the respective tables that we imported. That was easier than making fun of the metaverse.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="transform">Step 2: Transforming Data<a class="hash-link" href="#transform" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="data-cleansing">Data Cleansing<a class="hash-link" href="#data-cleansing" title="Direct link to heading">â€‹</a></h3><p>There are two certainties in life: death and messy data. Time to clean up! Luckily, our
curated tutorial data only has 2 little &quot;messes&quot;.</p><p>First, the <code>time</code> of an order is given as the number of milliseconds since Unix epoch. We
need to convert <code>time</code> to a proper DateTime field so we can handle it like a timestamp.</p><div class="codeBlockContainer_I0IT language-datasqrl theme-code-block"><div class="codeBlockContent_wNvx datasqrl"><pre tabindex="0" class="prism-code language-datasqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Orders.date := util.time.fromEpochMillis(time);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In this statement we are declaring a new field <code>date</code> on the <code>Orders</code> table and define it
by applying the utility function <code>util.time.fromEpochMillis</code> to the <code>time</code> field.</p><p>Secondly, the <code>discount</code> field on the order entries is absent when no discount was applied.
It&#x27;s pretty annoying to check for existence whenever we want to access that field. This
is an easy fix which defaults <code>discount</code> to <code>0.0</code> when the field is missing using the
<code>coalesce</code> function:</p><div class="codeBlockContainer_I0IT language-datasqrl theme-code-block"><div class="codeBlockContent_wNvx datasqrl"><pre tabindex="0" class="prism-code language-datasqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Orders.entries.discount := coalesce(discount, 0.0);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Nice, our data already looks much better. Adding to and overwriting fields on tables
incrementally makes it pretty easy to clean your data.
When you save the script, you can see the new <code>date</code> field on <code>Orders</code> in the API.</p><p>Note the nested table syntax in <code>Orders.entries</code> to reference the nested <code>entries</code> records
within the <code>Orders</code> table. SQRL supports <a href="/">nested tables</a> which is useful when dealing with
hierarchical data like our <code>Orders</code> data.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="structure">Data Structure<a class="hash-link" href="#structure" title="Direct link to heading">â€‹</a></h3><p>A Customer 360 application is all about the customer, so let&#x27;s restructure our data with
the customer at the center.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>SQRL is an extension of SQL and we are going to use some basic SQL syntax. If you are
unfamiliar with SQL, we recommend you read our <a href="/docs/reference/sqrl/sql-primer">SQL Primer</a>
first.</p></div></div><p>First, we define a <code>Customers</code> table based on the
unique customer ids from the <code>Orders</code> table.</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Customers := SELECT DISTINCT customerid AS id FROM Orders;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>So far, our tables are independent of one another. For our Customer 360, we want
to link customers to their orders to display a customer&#x27;s shopping history. We accomplish
this by defining a relationship between <code>Customers</code> and <code>Orders</code>:</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Customers.purchases := JOIN Orders ON Orders.customerid = _.id ORDER BY Orders.time DESC</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A relationship is declared as a field on a table which references the related records as
defined by the <code>JOIN</code> statement on the right. A JOIN relates records from two
tables based on a JOIN predicate - in our case matching customer ids.
The underscore is syntactic sugar that SQRL adds to SQL for referring to the table on the
left hand side on which the relationship is defined.</p><p>Similarly, we want to link the <code>Orders.entries</code> to the actual product records that they
reference. This calls for another relationship:</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Orders.entries.product := JOIN Products ON Products.id = _.productid LIMIT 1;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When you save the script, a <code>customers</code> endpoint has been added to the API and we can access
a customer&#x27;s shopping history and the products in their orders through the relationships we
just defined.</p><p>Try executing the following GraphQL query in GraphiQL to navigate through the relationships:</p><div class="codeBlockContainer_I0IT language-graphql theme-code-block"><div class="codeBlockContent_wNvx graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    customers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token attr-name" style="color:rgb(241, 250, 140)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token attr-name" style="color:rgb(241, 250, 140)">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token attr-name" style="color:rgb(241, 250, 140)">eq</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;50&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        items </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            purchases</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token attr-name" style="color:rgb(241, 250, 140)">pageSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                entries </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    quantity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    product </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        weight_in_grams</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can now navigate through our data with the uncanny agility of Luke
Skywalker in the Death Star.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="analysis">Step 3: Analyzing Data<a class="hash-link" href="#analysis" title="Direct link to heading">â€‹</a></h2><p>Let&#x27;s dig our hands even deeper into the data dough and do some data analysis. Our customers
would like to know how much they are spending and saving in our shop every month.</p><p>First, let&#x27;s compute the total and savings for each order as separate fields.</p><div class="codeBlockContainer_I0IT language-datasqrl theme-code-block"><div class="codeBlockContent_wNvx datasqrl"><pre tabindex="0" class="prism-code language-datasqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Orders.entries.total := quantity * unit_price - discount;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Orders.total := sum(entries.total);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Orders.savings := sum(entries.discount);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can use those fields to aggregate those values for each customer by month.</p><div class="codeBlockContainer_I0IT language-datasqrl theme-code-block"><div class="codeBlockContent_wNvx datasqrl"><pre tabindex="0" class="prism-code language-datasqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Customers.spending_by_month :=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         SELECT util.time.truncateToMonth(date) AS month,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                sum(total) AS total_spend,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                sum(discount) AS total_savings</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         FROM _.purchases</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         GROUP BY month ORDER BY month DESC;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This statement defines a nested table <code>spending_by_month</code> beneath <code>Customers</code> which takes
all the orders referenced by the <code>purchases</code> relationship on <code>Customers</code> for each customer
record and groups them by
the month of the order&#x27;s date. It then sums up the total and savings for all the orders in each
group. The utility function <code>truncateToMonth</code> takes a date and returns the date for the
beginning of the month in which that input date occurred.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="api">Step 4: Querying the API<a class="hash-link" href="#api" title="Direct link to heading">â€‹</a></h2><p>We got our data cleaned up, transformed into a customer-centric view, linked together through
relationships to access customers&#x27; shopping history, and we added a spending analysis.
<a href="/">Click here</a> to see the full script.</p><p>That&#x27;s a great start for a Customer 360 data service. And it is all readily accessible
through the GraphQL API.</p><p>The final step is to access the API from your application. We&#x27;ll look at an example in Javascript. Take a look at the <a href="/docs/guides/api/overview">API guides</a> to learn how to query the API from your favorite language or framework.</p><p>Create the Javascript file <code>index.js</code> with the following code:</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">ApolloClient</span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token imports"> gql</span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;@apollo/client&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> client </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ApolloClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uri</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;http://localhost:7050/graphql/customer360/v0&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This imports and connects the <a href="https://www.apollographql.com/docs/react/" target="_blank" rel="noopener noreferrer">Apollo GraphQL client</a>  to our customer 360 API. If you don&#x27;t have the client installed, run <code>npm install @apollo/client graphql</code> first. \
We can now run queries against it.</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">client</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    query</span><span class="token operator">:</span><span class="token plain"> gql</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">      query GetProduct {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">        products(filter: [{ id: {eq: &quot;1&quot;}}]) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">            items {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">                name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">                sizing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">                weight_in_grams</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token template-string string" style="color:rgb(255, 121, 198)">    </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">then</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">result</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Run this code to see the result printed to your console.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="next">Next Steps<a class="hash-link" href="#next" title="Direct link to heading">â€‹</a></h2><p>You just built and accessed a Customer 360 data service. Good work!
Give yourself a pat on the back.</p><p>This tutorial covered the basics of building data services in DataSQRL. We recommend that
you read the <a href="/docs/getting-started/intro/overview">DataSQRL Introduction</a> next because it extends this tutorial and
explains each of the concepts covered here in more detail. If you found this short tutorial too <em>dense</em> or missing information, the complete <a href="/docs/getting-started/intro/overview">DataSQRL Introduction</a> will fill in the gaps and teach you everything you need to know to build your own data services in DataSQRL.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dataengai/dataengai.github.io/edit/main/docs/docs/getting-started/nutshop-tutorial.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/getting-started/install"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Download &amp; Install</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/getting-started/intro/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Introduction to DataSQRL</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup" class="table-of-contents__link toc-highlight">Install</a></li><li><a href="#adding-data" class="table-of-contents__link toc-highlight">Step 1: Adding Data</a><ul><li><a href="#api" class="table-of-contents__link toc-highlight">Querying the API</a></li></ul></li><li><a href="#transform" class="table-of-contents__link toc-highlight">Step 2: Transforming Data</a><ul><li><a href="#data-cleansing" class="table-of-contents__link toc-highlight">Data Cleansing</a></li><li><a href="#structure" class="table-of-contents__link toc-highlight">Data Structure</a></li></ul></li><li><a href="#analysis" class="table-of-contents__link toc-highlight">Step 3: Analyzing Data</a></li><li><a href="#api" class="table-of-contents__link toc-highlight">Step 4: Querying the API</a></li><li><a href="#next" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/overview">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/overview">Reference Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/dev/overview">Developer Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://slack.com/invite/datasqrl" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/datasqrl" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">News</a></li><li class="footer__item"><a class="footer__link-item" href="/support">Support</a></li><li class="footer__item"><a href="https://github.com/tbd" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 DataSQRL, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9851348b.js"></script>
<script src="/assets/js/main.3edf6f1d.js"></script>
</body>
</html>