<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DataSQRL RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DataSQRL Atom Feed"><title data-react-helmet="true">Advanced Concepts | DataSQRL</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://dataengai.github.io/docs/getting-started/intro/advanced"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Advanced Concepts | DataSQRL"><meta data-react-helmet="true" name="description" content="You have made it through the entire extended tutorial and want to keep learning about DataSQLR? Kudos to you! This page highlights some advanced aspects of DataSQRL with pointers to more information so you can continue your journey to ninja SQRL status ðŸ¥‡."><meta data-react-helmet="true" property="og:description" content="You have made it through the entire extended tutorial and want to keep learning about DataSQLR? Kudos to you! This page highlights some advanced aspects of DataSQRL with pointers to more information so you can continue your journey to ninja SQRL status ðŸ¥‡."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dataengai.github.io/docs/getting-started/intro/advanced"><link data-react-helmet="true" rel="alternate" href="https://dataengai.github.io/docs/getting-started/intro/advanced" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dataengai.github.io/docs/getting-started/intro/advanced" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.deb948f4.css">
<link rel="preload" href="/assets/js/runtime~main.0a7fda19.js" as="script">
<link rel="preload" href="/assets/js/main.8502c6ef.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/head_squirrel.svg" alt="DataSQRL Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/head_squirrel.svg" alt="DataSQRL Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">DataSQRL</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/getting-started/overview">Learn</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/blog">News</a><a class="navbar__item navbar__link" href="/support">Support</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tbd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleChecked_cnQY toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" checked="" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/docs/getting-started/overview">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/install">Download &amp; Install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/nutshop-tutorial">Intro Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" tabindex="0" href="/docs/getting-started/intro/overview">DataSQRL Training</a><button aria-label="Toggle the collapsible sidebar category &#x27;DataSQRL Training&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/intro/data-sources">Connect Data Source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/intro/sqrl">Write SQRL Script</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/intro/api">Using the API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/intro/server">Operating DataSQRL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/intro/advanced">Advanced Concepts</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/why-datasqrl">Why DataSQRL?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/getting-started/comparison/overview">DataSQRL Comparison</a><button aria-label="Toggle the collapsible sidebar category &#x27;DataSQRL Comparison&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/guides/overview">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/reference/overview">Reference Documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference Documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/dev/overview">Developer Documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Advanced Concepts in DataSQRL</h1><p>You have made it through the entire extended tutorial and want to keep learning about DataSQLR? Kudos to you! This page highlights some advanced aspects of DataSQRL with pointers to more information so you can continue your journey to ninja SQRL status ðŸ¥‡.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="sqrl-functions">SQRL Functions<a class="hash-link" href="#sqrl-functions" title="Direct link to heading">â€‹</a></h2><p>we are going to start with good-ol&#x27; boring functions. Functions are incredibly useful, can make your script more concise, and your life a lot easier.</p><p>We used the function <code>function.time.fromEpochMillis</code> in the <a href="/docs/getting-started/nutshop-tutorial">nut shop tutorial</a> and referenced the function by its fully qualified name. If you use a function repeatedly, you can import it to save you from typing the full name.</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">IMPORT nutshop-data.Products;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">IMPORT nutshop-data.Orders;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">IMPORT function.time.fromEpochMillis;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Orders.date := fromEpochMillis(time);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can also import all functions in a particular package:</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">IMPORT function.time.*;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note, that the imported functions are placed in the same namespace as the imported tables and datasets, so you have to be careful that those names do not overlap. If they do, you can rename functions or tables on import.</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">IMPORT function.time.fromEpochMillis AS epoch2Millis;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Orders.date := epoch2Millis(time);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As a side note, <code>function</code> is a reserved keyword in SQRL and you cannot name your datasets or tables <code>function</code> to avoid confusion.</p><p>SQRL includes a lot of useful functions. You can view the <a href="/docs/category/functions">complete listing of function packages</a>. Here are some highlights:</p><ul><li><strong>iff</strong> is an inline if-then-else function that evaluates the boolean expression given as the first argument and returns the second argument if it is true, otherwise it returns the third argument. Great for small conditionals where <em>case-when</em> statements are overkill.</li><li><strong>coalesce</strong> returns the second argument if the first argument is null. Great for normalizing messy data.</li><li>If you are doing string transformations, take a look at the <a href="/docs/reference/sqrl/functions/string-fct">string function package</a>.</li><li>Working with timestamps, dates, and all matters of time gets a lot easier with the <a href="/docs/reference/sqrl/functions/time-fct">time function package</a>.</li><li>geo, statistics</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="hidden-fields-and-utility-functions">Hidden Fields and Utility Functions<a class="hash-link" href="#hidden-fields-and-utility-functions" title="Direct link to heading">â€‹</a></h2><p>DataSQRL automatically adds a few hidden columns to all records from imported data source tables:</p><ul><li><strong>_uuid</strong>: A unique identifier for the record assigned by the DataSQRL server on ingest.</li><li><strong>_ingest_time</strong>: A timestamp that marks the time when the record was ingested by DataSQRL server.</li><li><strong>_source_time</strong>: The timestamp attached to the record by the data source. This timestamp is only available if the data source supports it and null otherwise.</li></ul><p>The unique identifier is useful to distinguish records and track data lineage.</p><p>The timestamps are often used when we transform a change-record event table into an entity table as discussed in <a href="/docs/getting-started/intro/sqrl#event-entity%7D">the previous section</a> on entity and event tables. For example, we used <code>_ingest_time</code> in the entity table definition of the <code>Products</code> table:</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Products := DISTINCT Products ON id ORDER BY _ingest_time DESC;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This statement defines <code>Products</code> entity records as the last change event for each product id ordered by the time the events were ingested. We can also define <em>last</em> in terms of the source time of an event record:</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Products := DISTINCT Products ON id ORDER BY _source_time DESC;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In practice, the definitions lead to the same result unless records from the data source may arrive out of order when they are ingested by DataSQRL. In that case, it is better to use <code>_source_time</code> if the data source supports it.</p><p>To assign unique ids and timestamps to the event tables we define via subscriptions, we can use the utility functions <code>uuid()</code> and <code>now()</code> in the <code>SELECT</code> clause of the subscription:</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">NewCustomerPromotion := SUBSCRIPTION ON ADD AS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SELECT uuid() AS event_id, now() AS event_time, customerid, total_orders</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM Customers WHERE total_orders &gt;= 100;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="script-evolution">Script Evolution<a class="hash-link" href="#script-evolution" title="Direct link to heading">â€‹</a></h2><p>You&#x27;ve successfully submitted your SQRL script to production and the data service is running nicely. The PM is super excited by the Customer 360 functionality and after talking to some customers wants to break customer spending down by week instead of by month.</p><p>Easy enough for us. We replace <code>Customers.spending_by_month</code> with</p><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Customers.spending_by_week :=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         SELECT function.time.truncateToWeek(date) AS week,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                sum(total) AS total_spend,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                sum(discount) AS total_savings</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         FROM _.purchases</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         GROUP BY week ORDER BY week DESC;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We also update the queries, integrate it with the Customer 360 application, and run all our tests. We are ready to go to production. But if we submit this updated script, it would replace the existing data service API with an incompatible change which would break the currently running Customer 360 application that depends on the old API. Changing the data service and application at the same time is too cumbersome and could potentially result in some downtime.</p><p>Instead, we are going to submit our updated script as a new version:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">datasqrl submit customer360.sqrl -v v2 -q ./queries -s pre-schema.yml -r config.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This is the same <code>submit</code> command we used before with an additional argument <code>-v v2</code> which instructs DataSQRL to deploy the newly generated API as version <code>v2</code> and keep the old script running under API version <code>v1</code>. Note, that DataSQRL uses the version <code>v1</code> by default when you don&#x27;t specify a version.</p><p>Now, we can carefully migrate the Customer 360 React application to the new API version <code>v2</code>. Once that migration is complete and everything is running smoothly, we can remove the old version:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">datasqrl remove customer360.sqrl -v v1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Versioning is your friend as you evolve your data service and change things up. At some point, you may find that your SQRL script is getting too long and your API to overloaded. For instance, we may eventually split the Customer 360 API from the recommendation engine so we can develop those two components as separate services. \
You can trim down the <code>customer360.sqrl</code> script and move the <code>Customers.past_purchases</code> and <code>Customers.products_by_protein</code> to a new <code>recommendation.sqrl</code> script. Make sure you also copy or move all the column, table, and import statements those tables depend on. \
Now, you can submit a new version of the customer 360 script and also deploy the <code>recommendation.sqrl</code> script as a separate data service.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="hints">Hints and Optimization<a class="hash-link" href="#hints" title="Direct link to heading">â€‹</a></h2><p>You can control how DataSQRL executes your scripts by providing annotation hints.</p><p>Before we talk about those hints, let&#x27;s take a short detour to discuss how DataSQRL executes SQRL scripts. DataSQRL is a combination of a stream processing engine and a database. The stream processing engine ingests data from the connected sources, validates it, and updates the tables defined in the SQRL script that are affected by the new data record. Table records are eventually written to the database where they can be queried by the API to answer API requests.</p><p><em>(insert schematic diagram visualizing it)</em></p><p>When DataSQRL converts an SQRL script to an execution plan, the optimizer determines which tables and columns should be incrementally computed by the stream processing engine when new data arrives or computed upon request inside the database for each API query. This decision has important implications for the performance and cost of the data service.</p><p>For example, the column <code>Customers._recent_avg_protein</code> from our <code>customer360.sqrl</code> script would be very expensive to compute at query time when we request product recommendations from the API because it requires a multi-way <code>JOIN</code> starting from all orders that a customer placed in the last 6 month. If we computed this at query time, the database would have to fetch a lot of data which takes time and is costly. It is much cheaper to incrementally update this column value whenever the customer places a new order and store the result in the database so it is instantly available at query time. \
On the other hand, incrementally computing the <code>Customers.products_by_protein</code> table when data changes would be very expensive since the ordering changes anytime the <code>Customers._recent_avg_protein</code> changes with a new order for that customer. Since we only have a couple hundred product records that don&#x27;t change very often, it is much more efficient to compute <code>Customers.products_by_protein</code> at query time.</p><p>DataSQRL collects statistics on the source data and analyzes your script to make the optimal decision on whether to incrementally compute a particular table and column or compute it at query time. However, sometimes the optimizer gets it wrong. When that happens, you can provide a hint to DataSQRL to dictate that decision to the optimizer.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Please send us example SQRL scripts where the optimizer makes the wrong decision and produces suboptimal results. We are actively working on improving the optimizer and your input is super valuable to us.</p></div></div><div class="codeBlockContainer_I0IT language-sqrl theme-code-block"><div class="codeBlockContent_wNvx sqrl"><pre tabindex="0" class="prism-code language-sqrl codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- @optimizer(materialize=true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Customers._recent_avg_protein :=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        SELECT SUM(e.quantity * p.weight_in_gram * n.protein)/SUM(e.quantity * p.weight_in_gram)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        FROM _.purchases.entries e JOIN e.product p JOIN p.nutrition n</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        WHERE e.parent.date &gt; now() - INTERVAL 6 MONTH;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- @api(paginate=true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- @optimizer(materialize=false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Customers.products_by_protein :=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        SELECT p.id AS productid, ABS(p.nutrition.protein-_._recent_avg_protein) AS protein_difference FROM Products p</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ORDER BY protein_difference ASC LIMIT 20;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Customers.products_by_protein.product := JOIN Products ON Products.id = _productid LIMIT 1;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>With the <code>@optimizer</code> annotation we can pass hints to the optimizer. The boolean flag <code>materialize</code> tells the optimizer whether to incrementally update a table with changing data - i.e. to materialize a table as database folks would say - or to compute the table results at query time with each API request.</p><p>Learn more about the <a href="/docs/reference/operations/optimizer">DataSQRL optimizer</a> and how to provide hints to control the execution plan that it generates for your SQRL script. You can also learn more about the <a href="/docs/dev/architecture/overview">architecture of DataSQRL</a> to dive deep into the internals of the system.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="next-steps">Next Steps<a class="hash-link" href="#next-steps" title="Direct link to heading">â€‹</a></h2><p>Congratulations, you not only finished the extended tutorial but also completed the extra credit. What a champ! You are definitely ready to get started with DataSQRL.</p><p>For additional information, you can consult the <a href="/docs/reference/overview">reference documentation</a> which covers all the details and then some. \
If you are running into a problem or wonder how to solve a particular issue in DataSQRL, take a look at <a href="/docs/guides/overview">the how-to guides</a> which provide solutions for common questions. \
If neither of those resources address your problem, reach out to the community for help. We&#x27;d love to hear about your problem and support you as best we can.</p><p>Want to learn more about the internals of DataSQRL or contribute to the codebase? The <a href="/docs/dev/overview">developer documentation</a> provides a detailed breakdown of the DataSQRL architecture and everything you need to know to extend DataSQRL yourself.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dataengai/dataengai.github.io/edit/main/docs/docs/getting-started/intro/advanced.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/getting-started/intro/server"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Operating DataSQRL</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/getting-started/why-datasqrl"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Why DataSQRL?</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sqrl-functions" class="table-of-contents__link toc-highlight">SQRL Functions</a></li><li><a href="#hidden-fields-and-utility-functions" class="table-of-contents__link toc-highlight">Hidden Fields and Utility Functions</a></li><li><a href="#script-evolution" class="table-of-contents__link toc-highlight">Script Evolution</a></li><li><a href="#hints" class="table-of-contents__link toc-highlight">Hints and Optimization</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/overview">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/overview">Reference Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/dev/overview">Developer Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://slack.com/invite/datasqrl" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/datasqrl" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">News</a></li><li class="footer__item"><a class="footer__link-item" href="/support">Support</a></li><li class="footer__item"><a href="https://github.com/tbd" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 DataSQRL, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0a7fda19.js"></script>
<script src="/assets/js/main.8502c6ef.js"></script>
</body>
</html>